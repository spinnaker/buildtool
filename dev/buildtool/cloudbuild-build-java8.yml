steps:
  - id: buildCompileImage
    waitFor: ["-"]
    name: gcr.io/cloud-builders/docker
    args: [
            "build",
            "-t", "compile",
            "-f", "Dockerfile.compile",
            ".",
          ]
  - id: buildSlimImage
    waitFor: ["buildCompileImage"]
    name: gcr.io/cloud-builders/docker
    args: [
            "build",
            "-t", "$_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME",
            "-t", "$_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-slim",
            "-f", "Dockerfile.slim",
            ".",
          ]
  - id: buildUbuntuImage
    waitFor: ["buildCompileImage"]
    name: gcr.io/cloud-builders/docker
    args: [
            "build",
            "-t", "$_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-ubuntu",
            "-f", "Dockerfile.ubuntu",
            ".",
          ]
  - id: buildJava8Image
    waitFor: ["buildCompileImage"]
    name: gcr.io/cloud-builders/docker
    args: [
            "build",
            "-t", "$_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-java8",
            "-f", "Dockerfile.java8",
            ".",
          ]
  - id: buildUbuntuJava8Image
    waitFor: ["buildCompileImage"]
    name: gcr.io/cloud-builders/docker
    args: [
            "build",
            "-t", "$_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-ubuntu-java8",
            "-f", "Dockerfile.ubuntu-java8",
            ".",
          ]
images:
  - $_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME
  - $_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-slim
  - $_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-java8
  - $_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-ubuntu
  - $_DOCKER_REGISTRY/$_IMAGE_NAME:$TAG_NAME-ubuntu-java8
timeout: 3600s
options:
  machineType: N1_HIGHCPU_8
